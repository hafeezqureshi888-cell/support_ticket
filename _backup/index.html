<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Support Ticket Form — Vanilla JS + Tailwind</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 py-4 px-3 md:py-12 md:px-4">

  <div class="w-full md:max-w-xl md:mx-auto">
    <div id="card" class="bg-white rounded-lg shadow-md p-4 md:p-8 transition-all">

      <h1 class="mb-6 md:mb-8 text-xl md:text-2xl font-semibold text-gray-800">Submit a Support Ticket</h1>

      <!-- Success message (hidden by default) -->
      <div id="successMsg" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3 hidden">
        <!-- simple alert circle SVG -->
        <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 9v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 17h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <p id="successText" class="text-green-800">Your support ticket has been submitted successfully! We'll get back to you soon.</p>
        </div>
      </div>

      <form id="ticketForm" class="space-y-5" novalidate>

        <!-- Ticket Type -->
        <div>
          <label for="ticketType" class="block mb-2 text-gray-700">
            Ticket Type <span class="text-red-500">*</span>
          </label>

          <select id="ticketType" name="ticketType" data-field class="w-full px-3 py-3 md:px-4 md:py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
            <option value="">Select a ticket type</option>
            <option>Technical Issues</option>
            <option>Account & Billing</option>
            <option>Product & Service</option>
            <option>General Inquiry</option>
            <option>Feedback & Suggestions</option>
          </select>

          <p data-error-for="ticketType" class="mt-1.5 text-red-500 text-sm flex items-center gap-1 hidden">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 9v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 17h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="error-text"></span>
          </p>
        </div>

        <!-- Full Name -->
        <div>
          <label for="fullName" class="block mb-2 text-gray-700">
            Full Name <span class="text-red-500">*</span>
          </label>
          <input id="fullName" name="fullName" data-field type="text" placeholder="Enter your full name"
            class="w-full px-3 py-3 md:px-4 md:py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"/>
          <p data-error-for="fullName" class="mt-1.5 text-red-500 text-sm flex items-center gap-1 hidden">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 9v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 17h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="error-text"></span>
          </p>
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block mb-2 text-gray-700">
            Email Address <span class="text-red-500">*</span>
          </label>
          <input id="email" name="email" data-field type="email" placeholder="Enter your email address"
            class="w-full px-3 py-3 md:px-4 md:py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"/>
          <p data-error-for="email" class="mt-1.5 text-red-500 text-sm flex items-center gap-1 hidden">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 9v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 17h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="error-text"></span>
          </p>
        </div>

        <!-- Phone -->
        <div>
          <label for="phoneNumber" class="block mb-2 text-gray-700">
            Phone Number <span class="text-gray-500 text-sm">(Optional)</span>
          </label>
          <input id="phoneNumber" name="phoneNumber" data-field type="tel" placeholder="Enter your phone number"
            class="w-full px-3 py-3 md:px-4 md:py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" />
        </div>

        <!-- Subject -->
        <div>
          <label for="subject" class="block mb-2 text-gray-700">
            Subject <span class="text-red-500">*</span>
          </label>
          <input id="subject" name="subject" data-field type="text" placeholder="Short summary of the issue"
            class="w-full px-3 py-3 md:px-4 md:py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"/>
          <p data-error-for="subject" class="mt-1.5 text-red-500 text-sm flex items-center gap-1 hidden">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 9v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 17h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="error-text"></span>
          </p>
        </div>

        <!-- Description -->
        <div>
          <label for="description" class="block mb-2 text-gray-700">
            Description <span class="text-red-500">*</span>
          </label>
          <textarea id="description" name="description" data-field rows="5" placeholder="Describe your issue in detail…"
            class="w-full px-3 py-3 md:px-4 md:py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y transition-colors"></textarea>
          <p data-error-for="description" class="mt-1.5 text-red-500 text-sm flex items-center gap-1 hidden">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 9v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 17h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="error-text"></span>
          </p>
        </div>

        <!-- Submit -->
        <button id="submitBtn" type="submit"
          class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors mt-6">
          Submit Ticket
        </button>

      </form>
    </div>
  </div>

<script>
  // ---------- State (mimic React state) ----------
  const form = document.getElementById('ticketForm');
  const successMsg = document.getElementById('successMsg');

  // touched flags - track if a field has been blurred
  const touched = {};

  // current errors (fieldName -> message)
  let errors = {};

  // helper: select field element
  const field = (name) => document.querySelector('[name="' + name + '"]');

  // helper: get error container
  const errorEl = (name) => document.querySelector('[data-error-for="' + name + '"]');

  // email regex same as React
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  // Validate single field by name
  function validateField(name) {
    const val = (field(name) && field(name).value) ? field(name).value.trim() : '';
    let msg;

    switch (name) {
      case 'ticketType':
        if (!val) msg = 'Please select a ticket type';
        break;
      case 'fullName':
        if (!val) msg = 'Full name is required';
        break;
      case 'email':
        if (!val) msg = 'Email address is required';
        else if (!emailRegex.test(val)) msg = 'Please enter a valid email address';
        break;
      case 'subject':
        if (!val) msg = 'Subject is required';
        break;
      case 'description':
        if (!val) msg = 'Description is required';
        break;
    }

    if (msg) {
      errors[name] = msg;
    } else {
      delete errors[name];
    }

    // show or hide UI error depending on touched
    renderError(name);
  }

  // Validate all required fields
  function validateForm() {
    // required fields list
    const required = ['ticketType','fullName','email','subject','description'];
    required.forEach(n => validateField(n));
    return Object.keys(errors).length === 0;
  }

  // Show or clear error UI for a field (only visible if touched or after submit)
  function renderError(name) {
    const err = errors[name];
    const el = errorEl(name);
    const input = field(name);
    if (!el || !input) return;

    if (touched[name] && err) {
      el.querySelector('.error-text').textContent = err;
      el.classList.remove('hidden');
      input.classList.add('border-red-500');
    } else if (!err && !touched[name]) {
      el.classList.add('hidden');
      input.classList.remove('border-red-500');
    } else {
      // if no error but touched, hide
      if (!err) {
        el.classList.add('hidden');
        input.classList.remove('border-red-500');
      } else {
        // if error but not touched yet, keep hidden
        el.classList.add('hidden');
        input.classList.remove('border-red-500');
      }
    }
  }

  // Attach blur listener to all data-field controls to set touched and validateSingle
  document.querySelectorAll('[data-field]').forEach(el => {
    const name = el.name;
    el.addEventListener('blur', () => {
      touched[name] = true;
      validateField(name);
    });

    // on input change, clear error for that field (to mimic React clearing on typing)
    el.addEventListener('input', () => {
      if (errors[name]) {
        // revalidate but keep touched state
        validateField(name);
      }
    });
  });

  // Form submit handler
  form.addEventListener('submit', function(e) {
    e.preventDefault();

    // mark all required as touched
    ['ticketType','fullName','email','subject','description'].forEach(n => touched[n] = true);

    // run full validation
    const ok = validateForm();

    // render errors for all touched fields
    Object.keys(touched).forEach(n => renderError(n));

    if (ok) {
      // prepare data object (like formData)
      const data = {
        ticketType: field('ticketType').value,
        fullName: field('fullName').value.trim(),
        email: field('email').value.trim(),
        phoneNumber: field('phoneNumber').value.trim(),
        subject: field('subject').value.trim(),
        description: field('description').value.trim()
      };

      console.log('Form submitted:', data);
      
      // Requirement: File ticket into the correct MySQL database for that department
      console.log(`[System] Filing ticket into '${data.ticketType}' database...`);

      // show success UI
      successMsg.classList.remove('hidden');

      // reset form after 3 seconds and hide success message
      setTimeout(() => {
        form.reset();
        successMsg.classList.add('hidden');

        // clear touched and errors and UI
        Object.keys(touched).forEach(k => delete touched[k]);
        errors = {};
        // clear error UI for all fields
        document.querySelectorAll('[data-error-for]').forEach(e => {
          e.classList.add('hidden');
          const name = e.getAttribute('data-error-for');
          const inp = field(name);
          if (inp) inp.classList.remove('border-red-500');
        });
      }, 3000);
    } else {
      // scroll first error into view for convenience
      const firstErr = document.querySelector('[data-error-for]:not(.hidden)');
      if (firstErr) firstErr.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  });
</script>

</body>
</html>
